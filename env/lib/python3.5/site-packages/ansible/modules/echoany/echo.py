# coding: utf-8

from ansible.module_utils.basic import *
import os


def main():
    module = AnsibleModule(argument_spec=dict(args=dict(required=True)))

    args = module.params['args']
    try:
        res = os.popen('echo {0}'.format(args)).read().strip()

        res_json = dict(echo=res, changed=False, stdout_lines=res.split('\n'))

        module.exit_json(**res_json)
    except Exception as e:
        module.fail_json('error: %s' % e)


if __name__ == '__main__':
    main()


"""
module.fail_json(msg="error happened")
# 注意 module.fail_json 会造成ansibel-playbook 停止工作

res_json = dict(echo=res, changed=True)
 res_json 中的值会被输出到 stdout
    1. 其中的值可能会被ansible 重写
    2. 其中的值会被ansible 直接使用
    3. 在里面定义自己的值可以在playbook中被使用于逻辑判断， 先register 再 when判断
"""